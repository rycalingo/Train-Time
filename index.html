<!DOCTYPE HTML>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<title>FTL Express </title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="./assets/css/style.css">

</head>
<body>
	<div class="col-lg-12 col-md-12 col-sm-12">

        <div class="jumbotron text-center">
            <h2 class="title">FTL Express</h2>
        </div>
    
        <div class="col-lg-12 col-md-12 col-sm-12 group-fiels" >
            <form class="form-inline center-block">
					<div class="form-group col-md-2">
						<label for="webDevelopers" id="">Train Name</label><br>
	                    <input type="text" class="form-control field" id="train-name" placeholder="">
					</div>
					<div class="form-group col-md-2">
	                     <label for="webDevelopers" id="">Destination</label><br>
    	                 <input type="text" class="form-control field" id="dest" placeholder="">
					</div>
					<div class="form-group col-md-2">
	                     <label for="webDevelopers" id="train-time">First Train <span>(HH:mm - military time)</span></label><br>
	                     <input type="text" class="form-control field" id="first-train" placeholder="">
					</div>
    				<div class="form-group col-md-2">
	                    <label for="webDevelopers" id="">Frequency <span>(min)</span></label><br>
    	                 <input type="text" class="form-control field" id="freq" placeholder="">
					</div>
					<div class="form-group btns">
	                    <input type="button" name="add-train" id="submit" class="btn-primary" value="Submit">
                	</div>
            </form>
		</div>

        <div class="table-wrapper">
            <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Train Name</th>
                    <th>Destination</th>
                    <th>Frequency (min)</th>
                    <th>Next Arrival</th>
                    <th>Minute(s) Away</th>
                  </tr>
                </thead>
                <tbody>

                </tbody>
              </table>
        </div>

    </div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.4/moment.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>

<script type="text/javascript" src="./assets/js/scripts.js"></script>
    <script>
		  // Initialize Firebase
		  var config = {
		    apiKey: "AIzaSyDVvxCYLYSscytXs9zUCkKYV5Eyq8No0c8",
		    authDomain: "train-time-f5787.firebaseapp.com",
		    databaseURL: "https://train-time-f5787.firebaseio.com",
		    projectId: "train-time-f5787",
		    storageBucket: "",
		    messagingSenderId: "205504872898"
		  };
		  firebase.initializeApp(config);


        var database = firebase.database();

        var trainName, trainDestination, trainFrequency, nextArrival, minsAway;

        function addTrain(){

            var newTrain = {
                train: $("#train-name").val().trim(),
                dest: $("#dest").val().trim(),
                firstTrain: $("#first-train").val().trim(),
               	frequency: $("#freq").val().trim()
            }
            return newTrain;
        };

        $("#submit").on("click", function(event) {
            event.preventDefault();

            database.ref().push(addTrain());
			$(".field").val("");
        });
        database.ref().on("child_added", function(snapshot) {
            var data = snapshot.val();

            for( var key in data ){

            	console.log(key + ": " + data[key]);

            };
            var timeArrival = calTimes(data.firstTrain, data.frequency);
console.log(timeArrival);
            var newRow = "<tr>" +
            			 "<td>" + data.train + "</td>" + 
            			 "<td>" + data.dest + "</td>" + 
            			 "<td>" + data.frequency + "</td>" +
            			 "<td>" + timeArrival.arr + "</td>" +
            			 "<td>" + timeArrival.mins + "</td>"
            			 "</tr>";

            $("tbody").append(newRow);


        });

        function calTimes(start, freq) {
        	var format = "HH:mm";
// current time
			var now = moment();
// start time
        	var s = moment(start, format);
// frequency
        	var f = freq;

        	var diff = moment().diff(moment(s), "minutes");

        	var minsAway = f - diff % f;

        	var arr = moment().add(minsAway, "minutes");

        	var results = "start: " + s.format(format) + ", now: " + now.format(format) + ", diff: " + diff + ", freq: " + f;

        	var data = {arr: arr.format('hh:mma'), mins: minsAway}

        	console.log(results);

        	return data;
        }
    </script>
</body>

</html>